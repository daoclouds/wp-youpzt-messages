<?php
/**
 * @package wp-youpzt-messages
 *
 * @author: youpzt
 * @url: http://www.youpzt.com
 * @email: 981248356@qq.com
 
 Template Name: 站内信模板
 
 */
 ?>

<?php
if (!is_user_logged_in()) {
	redirect_to_login_url();
}
get_header();

global $current_user;

?>
<link rel='stylesheet' id='youpztMessages'  href='<?php echo YPM_CSS_URL;?>message-style.css' type='text/css' />
<div class="hfeed content ypzt-message">
	<div class="ypzt-message-border">
	<h2><a href="<?php echo get_permalink();?>"><?php the_title(); ?></a></h2>
	<div class="ypzt-message-title-img"><?php echo get_avatar($current_user->ID,64);?><span><?php echo $current_user->display_name;?></span></div>
	<div class="ypzt-message-information">
		<span>未读消息：<span class="ypzt-number"><a href="javascript:(0)"><?php echo get_messages_noread_count($current_user->ID);?></a></span>条</span>
		<span>您共收到消息：<span class="ypzt-number"><a href="javascript:(0)" onclick="ypmSwitch('pm-inbox');"><?php echo get_messages_count($current_user->ID,-1);?></a></span>条</span>
	</div>
	<div class="ypzt-message-title">
	<a href="javascript:void(0);" onclick="ypmSwitch('pm-send');"><i class="iconfont">&#xe601;</i>发送</a><a href="javascript:void(0);" onclick="ypmSwitch('pm-inbox');"><i class="iconfont">&#xe603;</i>收件箱</a><a href="javascript:void(0);" onclick="ypmSwitch('pm-outbox');"><i class="iconfont">&#xe604;</i>已发送信息</a>
	</div>
	</div>
	<script type="text/javascript">
		// Switch between send page, inbox and outbox
		function ypmSwitch(page) {
			document.getElementById('pm-send').style.display = 'none';
			document.getElementById('pm-inbox').style.display = 'none';
			document.getElementById('pm-outbox').style.display = 'none';
			document.getElementById(page).style.display = '';
			return false;
		}
	</script>
	<!-- Include scripts and style for autosuggest feature -->
	<script type="text/javascript" src="<?php echo WP_PLUGIN_URL; ?>/wp-youpzt-messages/js/script.js"></script>

	<?php if (have_posts()) : while (have_posts()) : the_post(); ?>
	<div class="post ypzt-mt-10 ypzt-message-content" id="post-<?php the_ID(); ?>">
		<?php
		$show = array(true, false, false);
		if (isset($_REQUEST['page']) && $_REQUEST['page'] == 'ypm_inbox') {
			$show = array(false, true, false);
		} elseif (isset($_REQUEST['page']) && $_REQUEST['page'] == 'ypm_outbox') {
			$show = array(false, false, true);
		}
		?>
		<div id="pm-send" <?php if (!$show[0]) echo 'style="display:none"'; ?>><?php youpzt_messages_send(get_the_ID());?></div>
		<div id="pm-inbox" <?php if (!$show[1]) echo 'style="display:none"'; ?>><?php youpzt_messages_inbox(get_the_ID());?></div>
		<div id="pm-outbox" <?php if (!$show[2]) echo 'style="display:none"'; ?>><?php youpzt_messages_outbox(get_the_ID());?></div>
	</div>
	<?php endwhile; endif; ?>
</div>

<?php get_footer(); ?>
